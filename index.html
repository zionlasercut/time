<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>膠板生產時間計算器</title>
  <style>
    body { margin:0; padding:0; font-family:"Microsoft JhengHei", sans-serif; background:#f4f8fc; }
    .container { max-width:700px; margin:40px auto; background:#fff; padding:24px;
                 border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.1); }
    h2 { text-align:center; color:#2a3b66; margin-bottom:24px; }
    table { width:100%; border-collapse:collapse; }
    th, td { border:1px solid #cdd2da; padding:8px; text-align:center; font-size:0.95em; }
    th { background:#e9edf5; color:#2a3b66; }
    .section-header td { background:#d9e6fa; color:#304a75; font-weight:600; text-align:left; padding-left:12px; }
    select, input[type=number] {
      width:88%; padding:6px; border:1px solid #babfd1; border-radius:6px;
      background:#f3f6fa; font-size:1em;
    }
    .calc-result { color:#e24a2a; font-weight:600; }
    .summary-row td { background:#f1f2f5; font-weight:700; }
    .btn { float:right; margin-top:16px; padding:10px 24px; background:#2457e6;
           color:#fff; border:none; border-radius:8px; cursor:pointer; font-size:1em; }
    .btn:hover { background:#1b43b1; }
  </style>
</head>
<body>
  <h1>膠板生產時間計算器</h1>
  <h2>膠板生產時間計算器</h2>
  <table>
    <thead>
      <tr><th>項目</th><th>選項</th><th>時間 (分)</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>1. 量度及核對呎吋</td>
        <td>
          <label for="ratio">比例?</label>
          <select id="ratio"><option>載入中…</option></select>
        </td>
        <td><span id="ratio-time">0</span></td>
      </tr>
      <tr>
        <td></td>
        <td>
          <label for="factory-model">原廠模型?</label>
          <select id="factory-model"><option>載入中…</option></select>
        </td>
        <td><span id="factory-model-time">0</span></td>
      </tr>
      <tr>
        <td></td>
        <td>
          <label for="surface">涉及曲面?</label>
          <select id="surface"><option>載入中…</option></select>
        </td>
        <td><span id="surface-time">0</span></td>
      </tr>
      <tr>
        <td>2. 繪圖</td>
        <td>
          <label for="ref-img">有參考圖?</label>
          <select id="ref-img"><option>載入中…</option></select>
        </td>
        <td><span id="ref-img-time">0</span></td>
      </tr>
      <tr>
        <td></td>
        <td>
          <label for="draw-overlay">涉及疊加?</label>
          <select id="draw-overlay"><option>載入中…</option></select>
        </td>
        <td><span id="draw-overlay-time">0</span></td>
      </tr>
      <tr>
        <td></td>
        <td>
          <label for="board-size">膠板大小?</label>
          <select id="board-size"><option>載入中…</option></select>
        </td>
        <td><span id="board-size-time">0</span></td>
      </tr>
      <tr>
        <td></td>
        <td>
          <label for="board-thickness">膠板厚度?</label>
          <select id="board-thickness"><option>載入中…</option></select>
        </td>
        <td><span id="board-thickness-time">0</span></td>
      </tr>
      <tr>
        <td>3. 列印膠板</td>
        <td>
          <label for="print-overlay">涉及疊加?</label>
          <select id="print-overlay"><option>載入中…</option></select>
        </td>
        <td><span id="print-overlay-time">0</span></td>
      </tr>
      <tr>
        <td></td>
        <td>
          <label for="print-diff-thickness">涉及不同厚度膠板?</label>
          <select id="print-diff-thickness"><option>載入中…</option></select>
        </td>
        <td><span id="print-diff-thickness-time">0</span></td>
      </tr>
      <tr>
        <td></td>
        <td>
          <label for="print-count">列印數量？<br>(如鏡射便當2塊)</label>
          <input id="print-count" type="number" min="0" value="0">
        </td>
        <td><span id="print-count-time">0</span></td>
      </tr>
      <tr>
        <td>總時間 (分鐘)</td>
        <td></td>
        <td><span id="total-time">0</span></td>
      </tr>
    </tbody>
  </table>
  <button id="clear-btn">清除</button>

  <!-- 引入 xlsx.js -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // 將每個部分對應的工作表名稱定義好
      const sheetNames = {
        ratio: '比例',
        factoryModel: '原廠模型',
        surface: '涉及曲面',
        refImg: '有參考圖',
        drawOverlay: '繪圖疊加',
        boardSize: '膠板大小',
        boardThickness: '膠板厚度',
        printOverlay: '列印疊加',
        printDiffThickness: '列印不同厚度',
        printCount: '列印數量'
      };

      // 對應到頁面上的 <select>、<input>、<span>
      const selects = {
        ratio: document.getElementById('ratio'),
        factoryModel: document.getElementById('factory-model'),
        surface: document.getElementById('surface'),
        refImg: document.getElementById('ref-img'),
        drawOverlay: document.getElementById('draw-overlay'),
        boardSize: document.getElementById('board-size'),
        boardThickness: document.getElementById('board-thickness'),
        printOverlay: document.getElementById('print-overlay'),
        printDiffThickness: document.getElementById('print-diff-thickness')
      };
      const timeSpans = {
        ratio: document.getElementById('ratio-time'),
        factoryModel: document.getElementById('factory-model-time'),
        surface: document.getElementById('surface-time'),
        refImg: document.getElementById('ref-img-time'),
        drawOverlay: document.getElementById('draw-overlay-time'),
        boardSize: document.getElementById('board-size-time'),
        boardThickness: document.getElementById('board-thickness-time'),
        printOverlay: document.getElementById('print-overlay-time'),
        printDiffThickness: document.getElementById('print-diff-thickness-time'),
        printCount: document.getElementById('print-count-time')
      };
      const printCountInput = document.getElementById('print-count');
      const totalTimeSpan   = document.getElementById('total-time');
      const clearBtn        = document.getElementById('clear-btn');

      // 讀取指定工作表，若找不到就回傳空陣列
      function loadSheet(workbook, name) {
        const sheet = workbook.Sheets[name];
        if (!sheet) {
          console.warn(`工作表「${name}」找不到，已跳過`);
          return [];
        }
        return XLSX.utils.sheet_to_json(sheet, { header: ['選項','時間'], range: 1 });
      }

      // 主程式：載入 Excel、填選單、綁事件
      async function init() {
        try {
          const resp     = await fetch('Working_time.xlsx');
          const arrayBuf = await resp.arrayBuffer();
          const wb       = XLSX.read(arrayBuf, { type: 'array' });
          const data     = {};
          // 逐一載入各工作表
          for (let key in sheetNames) {
            data[key] = loadSheet(wb, sheetNames[key]);
          }
          // 填充下拉選單
          for (let key in selects) {
            const rows = data[key] || [];
            if (rows.length) {
              selects[key].innerHTML = rows.map(r => `<option value="${r.時間}">${r.選項}</option>`).join('');
            } else {
              selects[key].innerHTML = '<option value="0">0</option>';
            }
          }
          // 綁定變更與輸入事件
          for (let key in selects) {
            selects[key].addEventListener('change', updateTimes);
          }
          printCountInput.addEventListener('input', updateTimes);
          clearBtn.addEventListener('click', function(){
            for (let key in selects) selects[key].value = '0';
            printCountInput.value = 0;
            updateTimes();
          });
          updateTimes();
        } catch (err) {
          console.error(err);
        }
      }

      // 計算並更新各區塊時間與總時間
      function updateTimes() {
        let total = 0;
        // 計算除列印數量以外的各項
        for (let key in selects) {
          const t = parseFloat(selects[key].value) || 0;
          timeSpans[key].textContent = t;
          total += t;
        }
        // 列印數量公式：(膠板大小 時間 + 偏移值) × (列印數量 / 4)
        const boardT = parseFloat(timeSpans.boardSize.textContent) || 0;
        const offset = 0;  // 如需偏移值，可在此修改
        const cnt    = parseFloat(printCountInput.value) || 0;
        const pt     = (boardT + offset) * (cnt / 4);
        timeSpans.printCount.textContent = pt.toFixed(2);
        total += pt;
        totalTimeSpan.textContent = total.toFixed(2);
      }

      init();
    });
  </script>
</body>
</html>